[tox]
envlist = py311,py312,lint,type,coverage

# Python version compatibility testing
[testenv]
deps =
    pytest
    pytest-asyncio
    pytest-cov
    pytest-timeout
    pytest-xdist
    aiofiles
    aiosqlite

commands =
    pytest tests/ -v --tb=short

# Linting
[testenv:lint]
deps =
    black
    isort
    flake8
    pylint

commands =
    black --check app/ tests/
    isort --check-only app/ tests/
    flake8 app/ tests/ --max-line-length=127

# Type checking
[testenv:type]
deps =
    mypy
    types-pyyaml
    types-requests

commands =
    mypy app/ --ignore-missing-imports --no-strict-optional

# Coverage
[testenv:coverage]
deps =
    pytest
    pytest-asyncio
    pytest-cov
    coverage

commands =
    pytest tests/ --cov=app --cov-report=html --cov-report=term-missing
    coverage report --fail-under=80

# E2E tests only
[testenv:e2e]
deps =
    pytest
    pytest-asyncio
    pytest-cov

commands =
    pytest tests/test_e2e_workflows.py tests/test_smoke_tests.py tests/test_integration_e2e.py -v

# Smoke tests only
[testenv:smoke]
deps =
    pytest
    pytest-asyncio

commands =
    pytest tests/test_smoke_tests.py -v -m smoke

# Security testing
[testenv:security]
deps =
    bandit
    safety

commands =
    bandit -r app/
    safety check

# Documentation
[testenv:docs]
deps =
    sphinx
    sphinx-rtd-theme

commands =
    sphinx-build -b html docs/ docs/_build/

# Performance benchmarking
[testenv:benchmark]
deps =
    pytest
    pytest-asyncio
    pytest-benchmark

commands =
    pytest tests/ -v --benchmark-only
