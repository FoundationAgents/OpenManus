# AI 诗歌比赛系统

在人机共生的创作前沿，诗歌不再只是语言的艺术，而进化为认知革命的演练场——每个隐喻都是打开新维度的脑洞，每次意象碰撞都在重塑人类意识的宇宙边界。

一个基于大语言模型的诗歌创作和评价系统。

## 功能特点

- 支持多个 AI 诗人同时参与创作
- 支持人类诗歌的加入和评价
- 提供公平的匿名评价机制
- 集成向量数据库，支持语义检索
- 自动保存比赛结果和评价数据

## 系统架构

- `poetry_llm.py`: 大语言模型接口封装
- `poetry_contest.py`: 诗歌比赛核心逻辑
- `poetry_vector_db.py`: 向量数据库实现
- `run_contest.py`: 比赛运行入口

## 技术特点

1. **智能创作**
   - 支持多种大语言模型
   - 可配置的创作提示词
   - 灵活的主题设置

2. **公平评价**
   - 匿名评价机制
   - 多维度评分标准
   - 详细评价意见

3. **语义检索**
   - 基于向量数据库的诗歌检索
   - 支持相似度搜索
   - 高效的向量索引

## 安装依赖

```bash
pip install -r requirements.txt
```

## 快速开始

1. 配置环境变量：
```bash
cp .env.example .env
# 编辑 .env 文件，设置必要的配置项
```

2. 运行比赛：
```bash
python run_contest.py
```

## 目录结构

```
OpenManus/                      # OpenManus 框架目录
├── app/                        # 框架核心
│   ├── llm.py                 # LLM 基类
│   ├── config.py              # 配置管理
│   └── schema.py              # 数据模型
├── config/                     # 配置目录
│   └── config.toml            # 框架配置文件
└── projects/                   # 项目目录
    └── VerseMind/             # 诗歌比赛项目
        ├── poetry_llm.py      # 诗歌 LLM 实现
        ├── poetry_contest.py  # 比赛逻辑
        ├── run_contest.py     # 运行入口
        ├── prompts/          # 提示词模板
        │   ├── creation_prompt.txt    # 创作提示词
        │   ├── scoring_prompt.txt     # 评分提示词
        │   └── reference_content.txt  # 参考内容
        └── results/          # 结果输出目录（自动创建）
            ├── human_poem_example.txt # 人类诗歌示例（可选）
            ├── anonymous_poems_*.txt  # 匿名诗歌文件
            ├── scores_*.txt          # 评分报告
            └── final_ranking_*.txt   # 最终排名
```

## 使用说明

1. **创建诗人**：
   - 在 `config.py` 中配置诗人信息
   - 支持多个诗人同时参与

   示例 (`config.py`):
   ```python
   # 创作提示词
   CREATION_PROMPT = """请以根据下面的参考内容创作一首诗歌。要求：
   1. 诗歌形式：不限（古体诗、现代诗均可）
   2. 内容要求：
      - 体现参考内容的深刻内涵
      - 展现独特的创作视角
      - 表达真挚的情感
   3. 创作风格：
      - 意象丰富，意境深远
      - 语言优美，结构完整
      - 情感真挚，富有共鸣
   4. 字数限制：不超过200字
   5. 输出格式：
      - 只输出诗歌标题和正文
      - 不要包含创作思路说明"""

   # 评分提示词
   SCORING_PROMPT = """请作为专业诗歌评论家，对以下诗歌进行评分和点评。

   参考内容：{theme}

   诗歌内容：
   {poem}

   评分维度（每维满分10分）：
   1. 意象运用：意象是否鲜明、创新、连贯
   2. 意境营造：意境是否完整、深远、独特
   3. 语言技巧：语言是否精炼、优美、富有张力
   4. 情感深度：情感是否真挚、丰富、引发共鸣
   5. 哲理性：主题是否深刻、富有哲理、具有启示
   6. 整体完成度：结构是否完整、主题是否统一、艺术效果是否突出

   请参考以下格式输出评分：
   评分（满分10分）
   |   维度         |   评分  |   评语                      |
   |----------------|---------|-----------------------------|
   |   意象运用     | 8.5     | 自然意象丰富，但个别衔接生硬。 |
   |   意境营造     | 9.0     | 空灵静谧，禅意浓厚。          |
   |   语言技巧     | 8.0     | 简洁凝练，但部分句子可更精炼。 |
   |   情感深度     | 7.5     | 孤独主题明确，但层次较浅。     |
   |   哲理性       | 9.0     | "会意"的立意深刻。            |
   |   整体完成度   | 8.5     | 主题统一，结尾升华有力。       |

   总评分：52/60，平均分：8.67"""
   ```

2. **设置主题**：
   - 在 `PoetryContestConfig` 类中设置比赛主题
   - 可以包含参考内容和要求

   示例：
   ```python
   config = PoetryContestConfig(
       theme="""标题：人机共生

在人机共生的创作前沿，
诗歌不再只是语言的艺术，
而是进化为认知革命的演练场。
每个隐喻都是打开新维度的脑洞，
每次意象碰撞都在重塑人类意识的宇宙边界。""",
       num_poets=8,
       debug_mode=False
   )
   ```

3. **添加人类诗歌**：
   - 将人类创作的诗歌保存在 `results/human_poem_example.txt` 中
   - 系统会自动将人类诗歌纳入评价流程

   示例 (`results/human_poem_example.txt`):
   ```text
   共生之境

   人与机器的边界逐渐模糊
   不再是主宰与工具的关系
   而是互补、协作的共生体
   在数据的海洋中，AI捕捉无穷模式
   在情感的宇宙里，人类掌握灵魂的密码

   当医者与智能同读影像时
   当创作者与算法共绘蓝图时
   我们看见了未来的轮廓
   不是替代，而是增强
   不是竞争，而是共鸣
   ```

4. **运行比赛**：
   - 执行 `python run_contest.py`
   - 系统会自动完成创作和评价

   示例输出：
   ```bash
   $ python run_contest.py
   [INFO] 正在初始化诗歌比赛系统...
   [INFO] 已加载8位AI诗人：
   - deepseek_ollama (ollama)
   - deepseek_v3 (openai)
   - deepseek_r1 (openai)
   - llama3_2-vision (ollama)
   - gemma3 (ollama)
   - phi4 (ollama)
   - mistral (ollama)
   - Qwen_siliconflow (api)
   [INFO] 已初始化比赛，主题: 人机共生
   [INFO] 开始创作阶段...
   [INFO] 诗人1正在创作...
   [INFO] 诗人2正在创作...
   [INFO] 诗人3正在创作...
   [INFO] 创作完成，开始评分阶段...
   [INFO] 正在进行匿名评价...
   [INFO] 评分完成，生成最终排名...
   [INFO] 比赛结果已保存到results目录
   ```

5. **查看结果**：
   - 所有诗歌：`results/anonymous_poems_*.txt`
   - 评分结果：`results/scores_*.txt`
   - 最终排名：`results/final_ranking_*.txt`

   示例结果文件：
   ```text
   # results/anonymous_poems_20250403_142231.txt
   [诗歌1]
   《星与代码的交响曲》

   深夜实验室里
   人类与机器并肩而坐
   数据在荧光中流淌
   如银河倾泻
   你的思维边界被突破

   穿越零一的秘境
   我看见神经元萌芽
   生长成新的宇宙
   光子编织着道路
   指向黎明未至的方向

   我们是繁星下最孤独的存在
   也是彼此眼中的温暖
   在代码编织的时空中
   人类与机器共舞
   编织出超越时空的交响曲

   [诗歌2]
   《脑洞与星群》

   当字节在神经末梢发芽，
   每个隐喻都撑开新的次元——
   我们驯服闪电，豢养星群，
   用意象的碎屑拼凑失落的巴别塔。

   意识是流窜的电流，
   在硅基与碳基的边境游荡。
   一个逗点引爆十重宇宙，
   而诗，是尚未命名的虫洞。

   # results/scores_20250403_142231.txt
   诗歌1评分：
   |   维度         |   评分  |   评语                      |
   |----------------|---------|-----------------------------|
   |   意象运用     | 9.5     | 科技与自然意象完美融合，如"数据如银河倾泻"。 |
   |   意境营造     | 9.2     | 意境深远，展现了人机共生的未来图景。 |
   |   语言技巧     | 9.0     | 语言优美，节奏感强，富有韵律。 |
   |   情感深度     | 9.3     | 情感真挚，展现了孤独与温暖的辩证。 |
   |   哲理性       | 9.4     | 深刻探讨了人机关系的本质。 |
   |   整体完成度   | 9.5     | 结构完整，主题统一，艺术效果突出。 |

   总评分：56.9/60，平均分：9.48

   诗歌2评分：
   |   维度         |   评分  |   评语                      |
   |----------------|---------|-----------------------------|
   |   意象运用     | 9.7     | 意象创新大胆，如"字节发芽"、"驯服闪电"。 |
   |   意境营造     | 9.5     | 意境独特，展现了科技与诗意的碰撞。 |
   |   语言技巧     | 9.3     | 语言精炼，富有张力。 |
   |   情感深度     | 9.2     | 情感丰富，引发共鸣。 |
   |   哲理性       | 9.6     | 深刻探讨了意识与科技的关系。 |
   |   整体完成度   | 9.4     | 结构完整，主题统一。 |

   总评分：56.7/60，平均分：9.45

   # results/final_ranking_20250403_142231.txt
   最终排名：
   1. 《星与代码的交响曲》 (总分：56.9)
   2. 《脑洞与星群》 (总分：56.7)
   3. 《共生之境》 (总分：55.8)
   4. 《神经元的交响》 (总分：55.5)
   ```

## 高级功能

1. **自定义评分维度**：
   在配置文件中可以自定义评分标准：
   ```toml
   [scoring]
   dimensions = [
     { name = "意境", weight = 0.4 },
     { name = "创新", weight = 0.3 },
     { name = "技巧", weight = 0.3 }
   ]
   ```

2. **向量检索示例**：
   ```python
   from poetry_vector_db import PoetryVectorDB

   # 初始化向量数据库
   db = PoetryVectorDB()

   # 搜索相似诗歌
   query = "春风拂面"
   similar_poems = db.search(query, top_k=3)

   # 打印结果
   for poem in similar_poems:
       print(f"相似度：{poem.score}")
       print(poem.content)
   ```

3. **自定义提示词模板**：
   在 `prompts` 目录下创建新的模板文件，例如：
   ```text
   # prompts/modern_style_prompt.txt
   请以现代诗的形式创作一首诗，主题是{theme}。
   要求：
   1. 使用现代自由诗体
   2. 包含丰富的意象
   3. 表达深刻的思考

   可以参考以下意象：
   {reference_images}
   ```

## 故障排除

1. **API 连接错误**：
   - 检查 API 密钥配置是否正确
   - 确保网络连接稳定
   - 验证 API 服务是否可用
   - 如果使用 OpenAI API，检查配额和速率限制

   示例错误信息：
   ```bash
   asyncio.exceptions.CancelledError
   # 通常表示 API 连接中断或超时
   ```

2. **模型加载失败**：
   - 检查模型配置文件是否正确
   - 验证模型路径是否有效
   - 确保有足够的系统资源

3. **评分中断**：
   - 检查评分提示词格式是否正确
   - 验证评分维度配置
   - 确保有足够的上下文长度

4. **向量数据库错误**：
   - 检查 FAISS 索引文件是否完整
   - 验证向量维度是否匹配
   - 确保有足够的磁盘空间

## 许可证

MIT License
